<!DOCTYPE HTML>
<html>

<head>
	<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta name="format-detection" content="telephone=no" />
	<link rel="icon" type="image/x-icon" href="favicon" />
	<link rel="stylesheet" href="/style.css.gz">
	<script src="/chart.js.gz"></script>
	<title>Bar Graph</title>
</head>
<body>
	<form action="/graph_sw" method="POST"> Graph:
		<button class="btn btn--orange" type="submit" name="graph_param" value="2in1">2in1</button>
		<button class="btn btn--gray" type="submit" name="graph_param" value="bar">Bar</button>
		<button class="btn btn--orange" type="submit" name="graph_param" value="30s">30s</button>
		<button class="btn btn--orange" type="submit" name="graph_param" value="2m">2m</button>
		/
		<button class="btn btn--orange" type="submit" name="graph_param" value="bar">Reload</button>
		<button class="btn btn--orange" type="submit" name="graph_param" value="menu">Menu</button>
	</form>
	<div id="chart-1" class="container" style="height: 150px; margin: 0 auto"></div>
	<hr>
	<div id="chart-2" class="container" style="height: 150px; margin: 0 auto"></div>
	<small>
		<hr>&copy; 2022 Yosuke Tanaka
	</small>
</body>

<script>
	var chart1 = new Highcharts.Chart({
		chart: { renderTo: 'chart-1', animation: false, type: 'bar' },
		colors: ['#999999'],
		title: { text: 'O2Sensor#1 Voltage (mV)' },
		legend:{enabled: false },
		series: [
			{ data: [] },
		],
		plotOptions: {
			series: {
				animation: false,
				pointWidth: 50 
			}
		},
		drilldown: {
			animation: false
		},
		xAxis: {
			labels:
			{
				enabled: false
			}
		},
		yAxis: {		
			title: { text: '' },
			max: 1000, min: 0
		},
		credits: { enabled: false }
	});
	setInterval(function () {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (this.readyState == 4 && this.status == 200) {
				var x = (new Date()).getTime(),
					y = parseFloat(this.responseText);
				if (chart1.series[0].data.length > 0) {
					chart1.series[0].addPoint([x, y], true, true, true);
				} else {
					chart1.series[0].addPoint([x, y], true, false, true);
				}
			}
		};
		xhttp.open("GET", "/o2_in1", true);
		xhttp.send();
	}, 200);

	var chart2 = new Highcharts.Chart({
		chart: { renderTo: 'chart-2', animation: false, type: 'bar' },
		colors: ['#999999'],
		title: { text: 'O2Sensor#2 Voltage (mV)' },
		legend:{enabled: false },
		series: [
			{ data: [] },
		],
		plotOptions: {
			series: {
				animation: false,
				pointWidth: 50 
			}
		},
		drilldown: {
			animation: false
		},
		xAxis: {
			labels:
			{
				enabled: false
			}
		},
		yAxis: {			
			title: { text: '' },
			max: 1000, min: 0
		},
		credits: { enabled: false }
	});
	setInterval(function () {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (this.readyState == 4 && this.status == 200) {
				var x2 = (new Date()).getTime(),
					y2 = parseFloat(this.responseText);
				if (chart2.series[0].data.length > 0) {
					chart2.series[0].addPoint([x2, y2], true, true, true);
				} else {
					chart2.series[0].addPoint([x2, y2], true, false, true);
				}
			}
		};
		xhttp.open("GET", "/o2_in2", true);
		xhttp.send();
	}, 200);
</script>

</html>